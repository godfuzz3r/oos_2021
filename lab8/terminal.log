godfuzz3r@t480s:~ $ sudo vim /etc/pam.d/su
godfuzz3r@t480s:~ $ man useradd
godfuzz3r@t480s:~ $ sudo useradd -G wheel user1
godfuzz3r@t480s:~ $ sudo passwd user1
Changing password for user user1.
New password:
Retype new password:
passwd: all authentication tokens updated successfully
godfuzz3r@t480s:~ $ su - user1
Password:
user1@t480s:~ $ whoami
user1
user1@t480s:~ $ su
Password:
sh: Permission denied
user1@t480s:~ $ exit
logout
godfuzz3r@t480s:~ $ sudo vim /etc/pam.d/su
godfuzz3r@t480s:~ $ su - user1
Password:
user1@t480s:~ $ su
Password:
[root@t480s godfuzz3r]# whoami
root
[root@t480s godfuzz3r]# exit
exit
user1@t480s:~ $ exit
logout
godfuzz3r@t480s:~ $ man pam_pwquality
godfuzz3r@t480s:~ $ sudo vim /etc/security/pwquality.conf
godfuzz3r@t480s:~ $ sudo vim /etc/pam.d/system-auth
godfuzz3r@t480s:~ $ sudo passwd user1
Changing password for user user1.
New password:
BAD PASSWORD: The password is shorter than 12 characters
godfuzz3r@t480s:~ $ wget https://raw.githubusercontent.com/linux-pam/linux-pam/master/examples/check_user.c
godfuzz3r@t480s:~ $ gcc check_user.c -o check_user -lpam -lpam_misc
godfuzz3r@t480s:~ $ sudo vim /etc/pam.d/check
godfuzz3r@t480s:~ $ ./check_user godfuzz3r
Password:
Authenticated
godfuzz3r@t480s:~ $ su -
Password:
[root@t480s godfuzz3r]# passwd -e godfuzz3r
Expiring password for user godfuzz3r.
passwd: Success
[root@t480s godfuzz3r]# exit
logout
godfuzz3r@t480s:~ $ ./check_user godfuzz3r
Password:
Not Authenticated
